<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title></title>
	</head>
	<body style="background: #333;">
		<canvas id="canvas" width="" height="" style="display: block;margin: 0 auto;border: 1px solid #999;"></canvas>
		<input type="range" min="0.5" max="3.0" step="0.01" value="1.0" style="display: block;margin: 20px auto;width: 800px;" name="" id="slide" value="" />
		<canvas id="fd" width="" height="" style="display: none;"></canvas>
		<canvas id="xzcanvas" width="" height="" style="display: none;margin: 0 auto;border: 1px solid #999;"></canvas>
	</body>
	<script type="text/javascript">
		var canvas = document.getElementById("canvas");
		var context = canvas.getContext("2d");
		var image = new Image();
		var slide = document.getElementById("slide");
		var ismousedown = false;
//		水印
		var xzcanvas = document.getElementById("xzcanvas");
		var xzcontext = xzcanvas.getContext("2d");
//		放大镜
        var fd = document.getElementById("fd");
		var fd1 = fd.getContext("2d");
		
		var scale;
		window.onload = function(){
			var scale = slide.value;
			canvas.width = 899;
			canvas.height = 800;
			image.src = "c.jpg";
			image.onload = function(){
				imgscale(scale);
				fd.width = image.width;
				fd.height = image.height;
				scale = fd.width/canvas.width;
				context.drawImage(image,0,0,canvas.width,canvas.height);
				fd1.drawImage(image,0,0)
				slide.onmousemove=function(){
					scale=slide.value;
					imgscale(scale);
				}
				
			}
			
			xzcanvas.width = 600;
			xzcanvas.height = 100;
			xzcontext.font = "bold 50px Arial";
			xzcontext.fillStyle = "rgba(0,0,0,0.5)";
			xzcontext.textBaseline = "middle";
			xzcontext.fillText("=hello 世界=",160,50);
			
			
		}
		canvas.onmousedown = function(e){
			e.preventDefault();
			var point = wincanvas(e.clientX,e.clientY);
			console.log(point.x,point.y);
			ismousedown = true;
			drawcan(true,point);
			
		}
		canvas.onmousemove = function(e){
			e.preventDefault();
			if(ismousedown == true){
				var point = wincanvas(e.clientX,e.clientY);
			    console.log(point.x,point.y);
			    drawcan(true,point)
			}
		}
		canvas.onmouseup = function(e){
			e.preventDefault();
			ismousedown = false;
			drawcan(false);
		}
		canvas.onmouseout = function(e){
			e.preventDefault();
			ismousedown = false;
			drawcan(false);
		}
		function wincanvas(x , y){
			var box = canvas.getBoundingClientRect();
			return {x:x-box.left,y:y-box.top}
		}
		function drawcan(isdraw,point){
			context.clearRect(0,0,canvas.width,canvas.height);
			context.drawImage(image,0,0,canvas.width,canvas.height);
			if(isdraw == true){
				drawpoint(point);
			}
			
		}
		function drawpoint(point){
			
			var drawx=point.x*scale;
			var drawy=point.y*scale;
			var mr = 200;
			var dx = drawx - mr;
			var dy = drawy - mr;
			var dx1 = point.x - mr;
			var dy1 = point.y - mr;
			context.drawImage(fd,dx,dy,2*mr,2*mr,dx1,dy1,2*mr,2*mr)
			
		}
		
		function imgscale(scale){
			var imgwid = 899*scale;
			var imghei = 800*scale;
			var sx =canvas.width/2 - imgwid/2;
			var sy =canvas.height/2 - imghei/2;
			context.clearRect(0,0,canvas.width,canvas.height);
			context.drawImage(image,sx,sy,imgwid,imghei);
			context.drawImage(xzcanvas ,canvas.width-xzcanvas.width,
				                      canvas.height-xzcanvas.height);
		}
	</script>
</html>
